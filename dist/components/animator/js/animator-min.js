"use strict";if("undefined"==typeof _||!_)throw"ERROR: Lo-Dash is required for fi.fmi.metoclient.ui.animator.Utils!";var fi=fi||{};if(fi.fmi=fi.fmi||{},fi.fmi.metoclient=fi.fmi.metoclient||{},fi.fmi.metoclient.ui=fi.fmi.metoclient.ui||{},fi.fmi.metoclient.ui.animator=fi.fmi.metoclient.ui.animator||{},fi.fmi.metoclient.ui.animator.Utils=function(){function a(a,b){var c;if(a){var d=[a];b&&(d=d.concat(b)),c=a.bind.apply(a,d)}return c}var b="Browser not supported. Update browser.";!function(){Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw"Function.prototype.bind - what is trying to be bound is not callable";var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};d.prototype=this.prototype;var f=d;return e.prototype=new f,e})}(),function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}(),function(){if(!jQuery.browser){var a,b;jQuery.uaMatch=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},a=jQuery.uaMatch(navigator.userAgent),b={},a.browser&&(b[a.browser]=!0,b.version=a.version),b.chrome?b.webkit=!0:b.webkit&&(b.safari=!0),jQuery.browser=b}}(),function(){window.XDomainRequest&&jQuery.ajaxTransport(function(a){if(a.crossDomain&&a.async){a.timeout&&(a.xdrTimeout=a.timeout,delete a.timeout);var b;return{send:function(c,d){function e(a,c,e,f){b.onload=b.onerror=b.ontimeout=jQuery.noop,b=void 0,d(a,c,e,f)}b=new XDomainRequest,b.onload=function(){e(200,"OK",{text:b.responseText},"Content-Type: "+b.contentType)},b.onerror=function(){e(404,"Not Found")},b.onprogress=function(){},b.ontimeout=function(){e(0,"timeout")},b.timeout=a.xdrTimeout||0,b.open(a.type,a.url),b.send(a.hasContent&&a.data||null)},abort:function(){b&&(b.onerror=jQuery.noop,b.abort())}}}})}(),function(){Date.prototype.toISOString||(Date.prototype.toJSON||(Date.prototype.toJSON=function(){var a=function(a){return 10>a?"0"+a:a};return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z"}),Date.prototype.toISOString=Date.prototype.toJSON)}();var c=function(b,c){var d;if(b){var e=b.split("."),f=window||this;if(f){for(var g=0,h=e.length;h>g;g++)f=f[e[g]];"function"==typeof f&&(d=new(a(f,c)))}}return d},d=function(){var a=window&&document&&document.addEventListener;return a=a&&(window.HTMLCanvasElement?!0:!1),a=a&&!(window.opera&&window.opera.version&&parseFloat(window.opera.version())<12.1)},e=function(a,c){var e=d();if(!e&&a){var f=(c?c.browserNotSupportedInfo:void 0)||b;jQuery("."+a).append('<div class="errorInfo">'+f+"</div>"),"undefined"!=typeof console&&console&&console.error("ERROR: "+f)}return e};return{createInstance:c,isBrowserSupported:d,checkBrowserSupport:e}}(),"undefined"==typeof _||!_)throw"ERROR: Lo-Dash is required for fi.fmi.metoclient.ui.animator.WmsCapabilities!";if("undefined"==typeof OpenLayers||!OpenLayers)throw"ERROR: OpenLayers is required for fi.fmi.metoclient.ui.animator.WmsCapabilities!";var fi=fi||{};if(fi.fmi=fi.fmi||{},fi.fmi.metoclient=fi.fmi.metoclient||{},fi.fmi.metoclient.ui=fi.fmi.metoclient.ui||{},fi.fmi.metoclient.ui.animator=fi.fmi.metoclient.ui.animator||{},fi.fmi.metoclient.ui.animator.WmsCapabilities=function(){function a(a,b,c){a&&setTimeout(function(){a(b,c)},0)}function b(a){return a&&a.url&&!fi.fmi.metoclient.ui.animator.WfsCapabilities.isService(a)}function c(a,c){c.push.apply(c,_.uniq(_.filter(a,function(a){return a&&b(a)}),"url"))}function d(b){var c,d=[];if(!b.capabilities||!b.capabilities.url)throw"ERROR: WMS capabilities configuration is missing URL!";var e=new OpenLayers.Format.WMSCapabilities,k={SERVICE:f,VERSION:g,REQUEST:h};_.merge(k,b.params),OpenLayers.Request.GET({url:b.capabilities.url,params:k,success:function(f){var g=f.responseXML;g&&g.documentElement||(g=f.responseText),c=e.read(g),a(b.callback,c,d)},failure:function(e){var f={};if(f[i]=e.status,f[j]=e.statusText,d.push(f),"undefined"!=typeof console&&console){var g="ERROR: Response error: ";g+="Status: "+f[i],g+=", Text: "+f[j],console.error(g)}a(b.callback,c,d)}})}function e(a,c){c.push.apply(c,_.map(_.filter(a.layers,function(a){return a&&b(a.capabilities)}),"capabilities"))}var f="WMS",g="1.3.0",h="GetCapabilities",i="errorCode",j="errorText";return{isService:b,getUniqueConfigs:c,getData:d,getCapabilitiesConfigs:e}}(),"undefined"==typeof _||!_)throw"ERROR: Lo-Dash is required for fi.fmi.metoclient.ui.animator.WfsCapabilities!";var fi=fi||{};if(fi.fmi=fi.fmi||{},fi.fmi.metoclient=fi.fmi.metoclient||{},fi.fmi.metoclient.ui=fi.fmi.metoclient.ui||{},fi.fmi.metoclient.ui.animator=fi.fmi.metoclient.ui.animator||{},fi.fmi.metoclient.ui.animator.WfsCapabilities=function(){function a(a,b,c){a&&setTimeout(function(){a(b,c)},0)}function b(a){var b;return _.forEach(a,function(a){return a&&a.animation?(b=a.animation,!1):void 0}),b}function c(a){return a&&a.storedQueryId}function d(a,b){_.forEach(a,function(d){c(d)&&_.forEach(a,function(a){return d===a?(b.push(d),!1):d.url===a.url&&d.storedQueryId===a.storedQueryId?!1:void 0})})}function e(b){if(!(b.capabilities&&b.capabilities.url&&b.capabilities.layer&&b.capabilities.storedQueryId))throw"ERROR: WFS capabilities configuration is missing URL, layer or storedQueryId information!";var c=[],d=(new Date).getTime(),e={capability:{layers:[],request:{getcapabilities:{href:jQuery.trim(b.capabilities.url)}}}},f={request:"GetPropertyValue",valuereference:"wfs:FeatureCollection/wfs:member/omso:GridSeriesObservation/om:phenomenonTime/gml:TimeInstant/gml:timePosition",storedquery_id:b.capabilities.storedQueryId,starttime:new Date(d-g).toISOString().replace(/\.\d\d\dZ$/,"Z"),endtime:new Date(d+h).toISOString().replace(/\.\d\d\dZ$/,"Z")};_.merge(f,b.params),setTimeout(function(){jQuery.ajax({type:i,url:jQuery.trim(b.capabilities.url),dataType:j,data:f,success:function(d){var f={name:b.capabilities.layer,dimensions:{time:{values:[]}}};e.capability.layers.push(f),jQuery(d).find(k).each(function(){f.dimensions.time.values.push(new Date(jQuery.trim(jQuery(this).text())).getTime())}),a(b.callback,e,c)},error:function(d,e,f){var g={};if(g[l]=d.status,g[m]=f||e,c.push(g),"undefined"!=typeof console&&console){var h="ERROR: WFS XML response error: ";h+="Status: "+g[l],h+=", Text: "+g[m],console.error(h)}a(b.callback,void 0,c)}})},0)}function f(a,d){_.forEach(a.layers,function(a){if(c(a.capabilities)){d.push(a.capabilities);var e=b(a.args);e&&_.forEach(e.layers,function(b){d.push({url:a.capabilities.url,layer:b.layer,storedQueryId:b.storedQueryId})})}})}var g=864e5,h=864e5,i="GET",j="XML",k="gml\\:timePosition, timePosition",l="errorCode",m="errorText";return{isService:c,getUniqueConfigs:d,getData:e,getCapabilitiesConfigs:f}}(),"undefined"==typeof _||!_)throw"ERROR: Lo-Dash is required for fi.fmi.metoclient.ui.animator.Capabilities!";if("undefined"==typeof OpenLayers||!OpenLayers)throw"ERROR: OpenLayers is required for fi.fmi.metoclient.ui.animator.Capabilities!";var fi=fi||{};if(fi.fmi=fi.fmi||{},fi.fmi.metoclient=fi.fmi.metoclient||{},fi.fmi.metoclient.ui=fi.fmi.metoclient.ui||{},fi.fmi.metoclient.ui.animator=fi.fmi.metoclient.ui.animator||{},fi.fmi.metoclient.ui.animator.Capabilities=function(){function a(a){return fi.fmi.metoclient.ui.animator.WfsCapabilities.isService(a.capabilities)?fi.fmi.metoclient.ui.animator.WfsCapabilities:fi.fmi.metoclient.ui.animator.WmsCapabilities}function b(a,b){fi.fmi.metoclient.ui.animator.WfsCapabilities.getCapabilitiesConfigs(a,b),fi.fmi.metoclient.ui.animator.WmsCapabilities.getCapabilitiesConfigs(a,b)}function c(a){var c=[],d=[];return b(a,d),fi.fmi.metoclient.ui.animator.WfsCapabilities.getUniqueConfigs(d,c),fi.fmi.metoclient.ui.animator.WmsCapabilities.getUniqueConfigs(d,c),c}function d(a,b,c){a&&setTimeout(function(){a(b,c)},0)}function e(a,b){var c;if(b&&a&&a.capability&&a.capability.layers)for(var d=a.capability.layers,e=0;e<d.length;++e){var f=d[e];if(f&&f.name===b){c=f;break}}return c}function f(a){var b;if(a){var c=a.dimensions;if(c){var d=c.time;d&&(b=d.values)}}return b}function g(a){var b,c=f(a);if(c&&c.length){if(b=c[0],1===c.length&&void 0!==b&&null!==b){b+="";var d=b.split("/");d.length&&(b=d[0])}b=new Date(isNaN(b)?b:parseInt(b,j))}return b}function h(a){var b,c=f(a);if(c&&c.length){if(b=c[c.length-1],void 0!==b&&null!==b&&1===c.length){b+="";var d=b.split("/");d.length>1&&(b=d[1])}b=new Date(isNaN(b)?b:parseInt(b,j))}return b}function i(b){if(!(b&&b.callback&&b.config)){var e="ERROR: Options object and config object and callback function in it are mandatory!";throw"undefined"!=typeof console&&console&&console.error(e),e}var f=_.once(d),g={nComplete:0,capabilities:[],errors:[]},h=c(b.config),i=h.length;i>0?_.each(h,function(c){var d={capabilities:c,callback:function(a,d){try{++g.nComplete,a&&g.capabilities.push({url:c.url,capabilities:a}),g.errors.push.apply(g.errors,d),g.nComplete===i&&f(b.callback,g.capabilities,g.errors)}catch(e){var h={};h[k]="ERROR: Error in GetCapabilities flow: "+e.toString(),"undefined"!=typeof console&&console&&console.error(h[k]),g.errors.push(h),g.nComplete===i&&f(b.callback,g.capabilities,g.errors)}},params:b.params};a(d).getData(d)}):f(b.callback,g.capabilities,g.errors)}var j=10,k="errorText";return{getData:i,getLayer:e,getLayerTimes:f,getBeginTime:g,getEndTime:h}}(),"undefined"==typeof OpenLayers||!OpenLayers)throw"ERROR: OpenLayers is required for fi.fmi.metoclient.ui.animator.Factory!";var fi=fi||{};if(fi.fmi=fi.fmi||{},fi.fmi.metoclient=fi.fmi.metoclient||{},fi.fmi.metoclient.ui=fi.fmi.metoclient.ui||{},fi.fmi.metoclient.ui.animator=fi.fmi.metoclient.ui.animator||{},"undefined"==typeof fi.fmi.metoclient.ui.animator.Utils||!fi.fmi.metoclient.ui.animator.Utils)throw"ERROR: fi.fmi.metoclient.ui.animator.Utils is required for fi.fmi.metoclient.ui.animator.Factory!";if("undefined"==typeof fi.fmi.metoclient.ui.animator.Capabilities||!fi.fmi.metoclient.ui.animator.Capabilities)throw"ERROR: fi.fmi.metoclient.ui.animator.Capabilities is required for fi.fmi.metoclient.ui.animator.Factory!";if(fi.fmi.metoclient.ui.animator.Factory=function(){function a(a,b){if(a&&b&&b>0){var c=a.getTime();if(c!==b){var d=c%b;d&&(c-=d,a.setTime(c))}}}function b(a,b){if(a&&b&&b>0){var c=a.getTime();if(c!==b){var d=c%b;d&&(c+=b-d,a.setTime(c))}}}var c="Browser not supported. Update browser.",d="auto",e="join",f=function(f){function g(a,b){var c;if(a&&b)for(var d=0;d<N.length;++d){var e=N[d];if(e){var f=e.capabilities;if(f&&b===e.url){var g=fi.fmi.metoclient.ui.animator.Capabilities.getLayer(f,a);if(g){c=g;break}}}}return c}function h(){if(L&&L.layers&&L.layers.length){b(P,z());for(var c=0;c<L.layers.length;++c){var d=L.layers[c];if(d)for(var e=0;e<d.args.length;++e){var f=d.args[e];if(f){var g,h=f.animation;if(h){var i=h.resolutionTime;if(void 0===i&&(i=z(),void 0===i))throw"ERROR: Animation resolution time missing!";if(h.isForecast&&(g=void 0!==h.beginTime?new Date(h.beginTime instanceof Date?h.beginTime.getTime():h.beginTime):A(),a(g,i),void 0!==g&&(void 0===P||P.getTime()>g.getTime())&&(P=g)),h.layers)for(var j=0;j<h.layers.length;++j){var k=h.layers[j];k&&(k.isForecast||h.isForecast)&&(g=void 0!==k.beginTime?new Date(k.beginTime instanceof Date?k.beginTime.getTime():k.beginTime):A(),a(g,i),void 0!==g&&(void 0===P||P.getTime()>g.getTime())&&(P=g))}break}}}}}}function i(c,e,f){c&&e&&(c.beginTime===d&&(c.beginTime=fi.fmi.metoclient.ui.animator.Capabilities.getBeginTime(e),b(c.beginTime,f)),c.endTime===d&&(c.endTime=fi.fmi.metoclient.ui.animator.Capabilities.getEndTime(e),a(c.endTime,f)))}function j(a,c){if(a&&c&&c.url&&c.layer){var d=g(c.layer,c.url);if(d){var f=a.resolutionTime;if(void 0===f&&(f=z(),void 0===f))throw"ERROR: Animation resolution time missing!";if(i(a,d,f),a.layers)for(var h=0;h<a.layers.length;++h){var j=a.layers[h];if(j&&j.layer&&(i(j,g(j.layer,c.url),f),j.beginTime===e)){if(j.beginTime=fi.fmi.metoclient.ui.animator.Capabilities.getEndTime(d),void 0===j.beginTime)throw"ERROR: Animation sub-layer missing capability begin time!";j.beginTime=new Date(j.beginTime.getTime()+1),b(j.beginTime,f)}}}}}function k(){try{if(N.length&&L&&L.layers)for(var a=0;a<L.layers.length;++a){var b=L.layers[a];if(b&&b.args)for(var c=0;c<b.args.length;++c){var d=b.args[c];if(d){var e=d.animation;if(e){j(e,b.capabilities);break}}}}h()}catch(f){var g="ERROR: Configuration check failed: "+f.toString();"undefined"!=typeof console&&console&&console.error(g),M.push(g)}}function l(a,b,c){b&&N.push.apply(N,b),c&&M.push.apply(M,c),k(),Q(a)}function m(a){var b=function(b,c){l(a,b,c)},c={config:L,callback:b};fi.fmi.metoclient.ui.animator.Capabilities.getData(c)}function n(){var a;if(L){var b=L.layers;if(b)for(var c=0;c<b.length;++c){var d=b[c];if(d&&d.args)for(var e=0;e<d.args.length;++e){var f=d.args[e];if(f){var g=f.animation;if(g){(!a||void 0!==g.resolutionTime&&null!==g.resolutionTime&&a<g.resolutionTime)&&(a=g.resolutionTime);break}}}}}return a}function o(){var a;if(L){var b=L.layers;if(b)for(var c=0;c<b.length;++c){var d=b[c];if(d&&d.args)for(var e=0;e<d.args.length;++e){var f=d.args[e];if(f){var g=f.animation;if(g){if(void 0!==g.beginTime&&null!==g.beginTime){var h=g.beginTime;h instanceof Date||(h=new Date(h)),(void 0===a||h.getTime()<a.getTime())&&(a=new Date(h.getTime()))}break}}}}}return a}function p(){var a;if(L){var b=L.layers;if(b)for(var c=0;c<b.length;++c){var d=b[c];if(d&&d.args)for(var e=0;e<d.args.length;++e){var f=d.args[e];if(f){var g=f.animation;if(g){if(void 0!==g.endTime&&null!==g.endTime){var h=g.endTime;h instanceof Date||(h=new Date(h)),(void 0===a||h.getTime()>a.getTime())&&(a=new Date(h.getTime()))}break}}}}}return a}function q(){return(L?L.browserNotSupportedInfo:void 0)||c}function r(){if(!G&&L&&L.map&&L.map.className){var a;if(L.map.args&&L.map.args.length>0){a=L.map.args;var b=a[0];b.theme||(b.theme=null)}G=fi.fmi.metoclient.ui.animator.Utils.createInstance(L.map.className,a)}return G}function s(){if(r()&&L&&L.layers&&0===O.length)for(var c,d=L.layers,e=0;e<d.length;++e){var f=d[e];if(c=void 0,f&&f.className&&f.args){for(var g=0;g<f.args.length;++g){var h=f.args[g];if(h){var i=h.animation;if(i){void 0===i.resolutionTime&&(i.resolutionTime=z()),void 0===i.beginTime&&(i.beginTime=A()),void 0===i.endTime&&(i.endTime=B()),i.resolutionTime&&(i.beginTime instanceof Date||(i.beginTime=new Date(i.beginTime)),a(i.beginTime,i.resolutionTime),i.endTime instanceof Date||(i.endTime=new Date(i.endTime)),b(i.endTime,i.resolutionTime));break}}}c=fi.fmi.metoclient.ui.animator.Utils.createInstance(f.className,f.args)}c&&O.push(c)}return O}function t(){return L?L.defaultZoomLevel:void 0}function u(){return L?L.animationFrameRate:void 0}function v(){return L?L.animationRefreshInterval:void 0}function w(){return L&&L.animationAutoStart?!0:!1}function x(){return L&&L.showAnimationInitProgress?!0:!1}function y(){return L&&L.showAnimationLoadProgress?!0:!1}function z(){if(void 0===H&&(H=L?L.animationResolutionTime:void 0,!H&&(H=n(),!H)))throw"ERROR: Animation configuration missing resolution time!";return H}function A(){if(void 0===I&&L&&(void 0!==L.animationDeltaToBeginTime?(I=new Date,L.animationDeltaToBeginTime?(I.setTime(I.getTime()-L.animationDeltaToBeginTime),a(I,z())):b(I,z())):(I=o(),void 0!==I&&a(I,z())),void 0===I))throw"ERROR: Animation configuration missing proper begin time!";return void 0===I?void 0:new Date(I.getTime())}function B(){if(void 0===J&&L&&(void 0!==L.animationDeltaToEndTime?(J=new Date,L.animationDeltaToEndTime?(J.setTime(J.getTime()+L.animationDeltaToEndTime),b(J,z())):a(J,z())):(J=p(),void 0!==J&&b(J,z())),void 0===J))throw"ERROR: Animation configuration missing proper end time!";return void 0===J?void 0:new Date(J.getTime())}function C(){return P}function D(){return L&&L.animationShowUtc?!0:!1}function E(){for(var a=[],b=0;b<N.length;++b)a.push(N[b].capabilities);return a}function F(a){if(!a){var b="ERROR: Factory init callback is mandatory!";throw"undefined"!=typeof console&&console&&console.error(b),b}try{M=[],N=[],m(a)}catch(c){var d=c.toString();"undefined"!=typeof console&&console&&console.error("ERROR: Factory init error: "+d),M.push(d),Q(a)}}var G,H,I,J,K=this,L=f,M=[],N=[],O=[],P=new Date,Q=function(a){a&&setTimeout(function(){try{a(K,M)}catch(b){"undefined"!=typeof console&&console&&console.error("ERROR: Callback function error: "+b.toString())}},0)};this.init=F,this.getCapabilities=E,this.getMap=r,this.getLayers=s,this.getDefaultZoomLevel=t,this.getAnimationFrameRate=u,this.getAnimationRefreshInterval=v,this.getAnimationAutoStart=w,this.showAnimationInitProgress=x,this.showAnimationLoadProgress=y,this.getAnimationResolution=z,this.getAnimationBeginDate=A,this.getAnimationEndDate=B,this.getForecastBeginDate=C,this.getAnimationShowUtc=D,this.getBrowserNotSupportedInfo=q};return f}(),"undefined"==typeof Raphael||!Raphael)throw"ERROR: Raphael JS is required for fi.fmi.metoclient.ui.animator.Controller!";if("undefined"==typeof jQuery||!jQuery)throw"ERROR: jQuery is required for fi.fmi.metoclient.ui.animator.Controller!";var fi=fi||{};if(fi.fmi=fi.fmi||{},fi.fmi.metoclient=fi.fmi.metoclient||{},fi.fmi.metoclient.ui=fi.fmi.metoclient.ui||{},fi.fmi.metoclient.ui.animator=fi.fmi.metoclient.ui.animator||{},"undefined"==typeof fi.fmi.metoclient.ui.animator.ControllerConfig||!fi.fmi.metoclient.ui.animator.ControllerConfig)throw"ERROR: fi.fmi.metoclient.ui.animator.ControllerConfig is required for fi.fmi.metoclient.ui.animator.Controller!";if(!fi.fmi.metoclient.ui.animator.ControllerConfig.sliderConfig||!fi.fmi.metoclient.ui.animator.ControllerConfig.sliderConfig.bgColor||!fi.fmi.metoclient.ui.animator.ControllerConfig.sliderConfig.textColor)throw"ERROR: fi.fmi.metoclient.ui.animator.ControllerConfig.sliderConfig and its properties are required for fi.fmi.metoclient.ui.animator.Controller!";if(!fi.fmi.metoclient.ui.animator.ControllerConfig.scaleConfig||!fi.fmi.metoclient.ui.animator.ControllerConfig.scaleConfig.bgColor)throw"ERROR: fi.fmi.metoclient.ui.animator.ControllerConfig.scaleConfig and its properties are required for fi.fmi.metoclient.ui.animator.Controller!";if(!fi.fmi.metoclient.ui.animator.ControllerConfig.scaleConfig.cellReadyColor||!fi.fmi.metoclient.ui.animator.ControllerConfig.scaleConfig.cellErrorColor||!fi.fmi.metoclient.ui.animator.ControllerConfig.scaleConfig.cellLoadingColor)throw"ERROR: fi.fmi.metoclient.ui.animator.ControllerConfig.scaleConfig and its cell properties are required for fi.fmi.metoclient.ui.animator.Controller!";if(!fi.fmi.metoclient.ui.animator.ControllerConfig.scaleConfig.obsBgColor||!fi.fmi.metoclient.ui.animator.ControllerConfig.scaleConfig.fctBgColor)throw"ERROR: fi.fmi.metoclient.ui.animator.ControllerConfig.scaleConfig and its background properties are required for fi.fmi.metoclient.ui.animator.Controller!";if(fi.fmi.metoclient.ui.animator.Controller=function(){var a=Raphael,b="Arial",c=14,d=function(d,e,f,g){function h(){return 82}function i(){return 27}function j(){return Math.floor(jQuery(lb.node).offset().left)}function k(){return j()+h()}function l(){sb.attr("stroke-width",0);var a=Math.floor(jQuery(sb.node).offset().left);return sb.attr("stroke-width",ib.strokeWidth),a}function m(){return l()+ib.sliderTipDx}function n(){return k()+u()/A()}function o(a){var b=v(),c=b?a.getUTCHours():a.getHours(),d=b?a.getUTCMinutes():a.getMinutes(),e=c>9?c:"0"+c;return e+=":",e+=d>9?d:"0"+d}function p(){return v()?"UTC":""}function q(){var a=m()-j();0>a&&(a=0),pb.attr("width",a);var b=lb.attr("width")-a;0>b&&(b=0),qb.attr("x",pb.attr("x")+a).attr("width",b)}function r(){return fb?fb.getForecastStartTime():0}function s(){return fb?fb.getStartTime()-u():0}function t(){return fb?fb.getEndTime():0}function u(){return fb?fb.getResolution():0}function v(){return fb.getAnimationShowUtc()}function w(){return lb.getBBox().x+h()}function x(){return lb.getBBox().y}function y(){var a=Math.floor(hb.width-h()-i());return 0>a&&(a=0),a}function z(){return Math.floor(lb.getBBox().height)}function A(){return fb&&y()?(t()-s())/y():1}function B(a){var b=u();if(void 0!==a&&null!==a&&b){var c=a%b;c&&(a=a-c+b)}return a}function C(a){var b=Math.floor(s()+(a-k())*A());return b<s()?b=s():b>t()&&(b=t()),b}function D(a){var b=k(),c=a-s(),d=A(),e=Math.floor(b+(d?c/d:0));return e}function E(){var a=new Date(B(C(m())));tb.attr("text",o(a))}function F(a){var b=/T-*\d+,0/;rb.forEach(function(c){var d=c.transform().toString(),e=d.match(b);if(e&&e.length){var f=parseInt(e[0].substring(1),10);c.transform(d.replace(b,"T"+(f+a)+",0"))}else c.transform("...T"+a+",0")})}function G(a){void 0!==vb&&(a=D(vb));var b=Math.round(a-m()),c=k();b&&a>=c&&a<=c+y()&&(F(b),E(),q())}function H(){rb.toFront(),E()}function I(){gb.proposePause(),ub=l()}function J(a){vb=C(ub+ib.sliderTipDx+a),gb.proposeTimeSelectionChange(vb)}function K(){var a=vb;ub=void 0,vb=void 0,gb.proposeTimeSelectionChange(a)}function L(){gb.proposeNextFrame()}function M(){gb.proposePreviousFrame()}function N(a,b){return b>0?L():0>b&&M(),!1}function O(){var a=fb?y()-P():0;return 0>a&&(a=0),a}function P(){var a=0,b=r(),c=s(),d=t();if(void 0!==b&&fb&&d-c){var e=u()||0;a=Math.floor(y()*(d-(b-e))/(d-c))}return 0>a&&(a=0),a}function Q(){var a=O(),b=P(),c=a+b;mb.attr("x",hb.x+h()).attr("width",c),nb.attr("x",hb.x+h()).attr("width",a),ob.attr("x",hb.x+h()+a).attr("width",b)}function R(){for(;kb.length;)kb.splice(0,1)[0].remove();var a=u(),b=y();if(a&&b){var c=s(),d=t(),e=Math.floor((d-c)/a);if(e>0)for(var f=b/e,g=w(),h=x()+z()-hb.progressCellHeight,i=0;e>i;++i){var j=eb.rect(g+i*f,h,f,hb.progressCellHeight);j.attr("fill",hb.bgColor).attr("stroke-width","0"),j.node.id="animationProgressCell_"+(c+(i+1)*a),kb.push(j),jQuery(j.node).mousewheel(N)}}}function S(a){for(var b,c=0;c<kb.length;++c)if(kb[c].node.id==="animationProgressCell_"+a){b=kb[c],b.attr("fill",hb.cellReadyColor);break}return b}function T(){for(;jb.length;)jb.splice(0,1)[0].remove();var a=u();if(a)for(var d,e=s(),f=t(),g=w(),h=Math.floor((f-e)/a),i=y()/h,j=0;h>=j;++j){var l=g+j*i,m=new Date(e+j*a),n=z()-(hb.height-hb.bgHeight),q=0===m.getMinutes()&&0===m.getSeconds()&&0===m.getMilliseconds();if((q||0===j||j===h)&&(n-=hb.progressCellHeight),n){var r=x()+z(),v=eb.path("M"+l+","+r+"V"+n);if(v.attr("stroke",Raphael.getRGB("white")).attr("opacity",.5),jb.push(v),jQuery(v.node).mousewheel(N),q&&h>j){var A=eb.text(l,x()+z()/3,o(m)).attr({"font-family":b,"font-size":c,fill:Raphael.getRGB("black")}),B=jQuery(A.node);B.offset().left>=k()&&B.offset().left+B.width()<=k()+y()?(jb.push(A),jQuery(A.node).mousewheel(N)):A.remove()}if(j===h){{var C=eb.text(l,x()+2*z()/3,p()).attr({"font-family":b,"font-size":c,fill:Raphael.getRGB("black"),"text-anchor":"end"});jQuery(C.node)}jb.push(C),jQuery(C.node).mousewheel(N)}}d=m.getHours()}}function U(a){for(var b=a.events,c=0;c<b.length;++c){var d=b[c].time.getTime(),e=S(d);e&&e.attr("fill",hb.bgColor)}}function V(){Q(),R(),T(),H(),q(),pb.toFront(),qb.toFront()}function W(a){U(a)}function X(a){for(var b=a.events,c=0;c<b.length;++c){var d=b[c].time.getTime(),e=S(d);e&&e.attr("fill",b[c].error?hb.cellErrorColor:hb.cellLoadingColor)}}function Y(a){for(var b=a.events,c=0;c<b.length;++c){var d=b[c].time.getTime(),e=S(d);e&&e.attr("fill",b[c].error?hb.cellErrorColor:hb.cellReadyColor)}}function Z(){}function $(){}function _(a){U(a)}function ab(a){for(var b=a.events,c=0;c<b.length;++c){var d=b[c].time.getTime();G(D(d))}}function bb(a){fb=a,a.addTimePeriodChangeListener({timePeriodChanged:function(){V()}}),a.addTimeSelectionChangeListener({selectedTimeChanged:function(a){G(D(a))}}),a.addForecastStartTimeChangeListener({forecastStartTimeChanged:function(){Q()}}),a.addAnimationEventsListener({loadAnimationStartedCb:W,loadFrameStartedCb:X,loadFrameCompleteCb:Y,loadGroupProgressCb:Z,loadCompleteCb:$,animationFrameContentReleasedCb:_,frameChangedCb:ab}),V()}function cb(a){gb=a}function db(){eb.remove()}var eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb=this;!function(){eb=a(d,e,f),ib={height:27,width:54,bgColor:fi.fmi.metoclient.ui.animator.ControllerConfig.sliderConfig.bgColor,strokeBgColor:fi.fmi.metoclient.ui.animator.ControllerConfig.sliderConfig.textColor,strokeWidth:0},hb={radius:0,x:0,y:0,width:e,height:f-ib.height,bgHeight:f-ib.height-12,progressCellHeight:12,bgColor:fi.fmi.metoclient.ui.animator.ControllerConfig.scaleConfig.bgColor,cellReadyColor:fi.fmi.metoclient.ui.animator.ControllerConfig.scaleConfig.cellReadyColor,cellErrorColor:fi.fmi.metoclient.ui.animator.ControllerConfig.scaleConfig.cellErrorColor,cellLoadingColor:fi.fmi.metoclient.ui.animator.ControllerConfig.scaleConfig.cellLoadingColor,obsBgColor:fi.fmi.metoclient.ui.animator.ControllerConfig.scaleConfig.obsBgColor,fctBgColor:fi.fmi.metoclient.ui.animator.ControllerConfig.scaleConfig.fctBgColor},ib.sliderTipHeight=ib.height*(3/7),ib.scaleX=ib.width/14,ib.scaleY=(ib.height+ib.sliderTipHeight)/7,ib.sliderTipDx=Math.floor(7*ib.scaleX),ib.y=hb.y+hb.height-Math.floor(ib.sliderTipHeight),jb=eb.set(),kb=eb.set(),lb=eb.rect(hb.x,hb.y,hb.width,hb.height,hb.radius),lb.attr("stroke-width",0),lb.attr("opacity",0),mb=eb.rect(hb.x+h(),hb.y,O()+P(),hb.height),mb.attr("fill",hb.bgColor),mb.attr("stroke-width",0),nb=eb.rect(hb.x+h(),hb.y,O(),hb.bgHeight),nb.attr("fill",hb.obsBgColor),nb.attr("stroke-width",0),ob=eb.rect(hb.x+h()+O(),hb.y,P(),hb.bgHeight),ob.attr("fill",hb.fctBgColor),ob.attr("stroke-width",0),pb=eb.rect(hb.x,hb.y,h(),hb.height),pb.attr("fill",Raphael.rgb(0,0,0)).attr("opacity",0),pb.attr("stroke-width",0),pb.click(M),qb=eb.rect(hb.x+e,hb.y,i(),hb.height),qb.attr("fill",Raphael.rgb(0,0,0)).attr("opacity",0),qb.attr("stroke-width",0),qb.click(L),jQuery([lb.node,mb.node,nb.node,ob.node,pb.node,qb.node]).mousewheel(N),rb=eb.set(),sb=eb.path("M0,2L0,7L14,7L14,2L9,2L7,0L5,2Z"),sb.attr("fill",ib.bgColor),sb.attr("stroke",ib.strokeBgColor),sb.attr("stroke-width",ib.strokeWidth),sb.transform("S"+ib.scaleX+","+ib.scaleY+",0,0T0,"+ib.y),tb=eb.text(27,ib.y+26,"00:00"),tb.attr({"font-family":b,"font-size":c,"font-weight":"bold"}),tb.attr("fill",ib.strokeBgColor).attr("stroke-width",0),rb.push(sb),rb.push(tb),rb.drag(J,I,K,wb,wb,wb),jQuery([sb.node,tb.node]).mousewheel(N),rb.hide(),setTimeout(function(){rb.show(),G(void 0!==g&&null!==g?D(g):n()),E()},0)}(),this.setTimeModel=bb,this.setTimeController=cb,this.remove=db};return d}(),"undefined"==typeof _||!_)throw"ERROR: Lodash is required for fi.fmi.metoclient.ui.animator.Animator!";if("undefined"==typeof jQuery||!jQuery)throw"ERROR: jQuery is required for fi.fmi.metoclient.ui.animator.Animator!";if("undefined"==typeof OpenLayers||!OpenLayers)throw"ERROR: OpenLayers is required for fi.fmi.metoclient.ui.animator.Animator!";if("undefined"==typeof OpenLayers.Layer||"undefined"==typeof OpenLayers.Layer.Animation||"undefined"==typeof OpenLayers.Layer.Animation.Utils||!OpenLayers.Layer.Animation.Utils)throw"ERROR: OpenLayers.Layer.Animation.Utils is required for fi.fmi.metoclient.ui.animator.Animator!";var fi=fi||{};if(fi.fmi=fi.fmi||{},fi.fmi.metoclient=fi.fmi.metoclient||{},fi.fmi.metoclient.ui=fi.fmi.metoclient.ui||{},fi.fmi.metoclient.ui.animator=fi.fmi.metoclient.ui.animator||{},"undefined"==typeof fi.fmi.metoclient.ui.animator.Utils||!fi.fmi.metoclient.ui.animator.Utils)throw"ERROR: fi.fmi.metoclient.ui.animator.Utils is required for fi.fmi.metoclient.ui.animator.Animator!";if("undefined"==typeof fi.fmi.metoclient.ui.animator.Factory||!fi.fmi.metoclient.ui.animator.Factory)throw"ERROR: fi.fmi.metoclient.ui.animator.Factory is required for fi.fmi.metoclient.ui.animator.Animator!";if("undefined"==typeof fi.fmi.metoclient.ui.animator.Controller||!fi.fmi.metoclient.ui.animator.Controller)throw"ERROR: fi.fmi.metoclient.ui.animator.Controller is required for fi.fmi.metoclient.ui.animator.Animator!";fi.fmi.metoclient.ui.animator.Animator=function(){function a(a){var b;return _.isObject(a)&&_.isFunction(a.clone)&&(b=a.clone()),b}var b=10,c=100,d={events:new OpenLayers.Events(this)},e=function(){function e(){if(void 0===V||V<h()||V>i()){var a=l();V=void 0!==a?a.getTime():h().getTime()}return V}function f(a){a&&-1===jQuery.inArray(a,fb)&&(!fb.length&&T.showAnimationLoadProgress()&&jQuery(".animatorLoadProgressbar").show(),fb.push(a))}function g(a){if(a&&fb.length){var b=jQuery.inArray(a,fb);-1!==b&&(fb.splice(b,1),fb.length||jQuery(".animatorLoadProgressbar").hide())}}function h(){return T.getAnimationBeginDate()}function i(){return T.getAnimationEndDate()}function j(){return T.getAnimationResolution()}function k(){return T.getForecastBeginDate()}function l(){var a,b=h().getTime(),c=k().getTime(),d=i().getTime();return c>b&&(a=c>d?d:c-j()),void 0===a?void 0:new Date(a)}function m(){return T.getAnimationShowUtc()}function n(){if(S){var a=jQuery("#"+S.playAndPauseDivId);a.length&&a.click(function(){void 0!==U?u():t()}),o()}}function o(){if(S){var a=jQuery("#"+S.playAndPauseDivId);a.length&&(a.removeClass("animatorPlay"),a.removeClass("animatorPause"),a.addClass(void 0!==U?"animatorPause":"animatorPlay"))}}function p(){d.events.triggerEvent("timechanged",{time:e()})}function q(){if(void 0===V)V=h().getTime();else{var a=j();V=V+a>i().getTime()?h().getTime():V+a}d.events.triggerEvent("timechanged",{time:V})}function r(){if(void 0===V)V=h().getTime();else{var a=j();V=V-a<h().getTime()?i().getTime():V-a}d.events.triggerEvent("timechanged",{time:V})}function s(a,b){V=a instanceof Date?a.getTime():a,d.events.triggerEvent("timechanged",{time:a}),jQuery.each(b,function(b,c){c.selectedTimeChanged(a)})}function t(){void 0===U&&(U=new Date,o(),v())}function u(){void 0!==U&&(U=void 0,o())}function v(){if(void 0!==U&&T){requestAnimationFrame(v);var a=new Date;U.getTime()+T.getAnimationFrameRate()<a.getTime()&&(U=a,q())}}function w(){u(),q()}function x(){u(),r()}function y(a,b,c,d){var e=jQuery('<div class="scroll-content-item ui-widget-header"></div>');e.css("background-image","url('"+c.url+"')"),d&&(e.addClass("selectedLegend"),b.css("background-image",e.css("background-image")));var f=a.width()||2;a.append(e);var g=f+e.outerWidth(!0);a.width()<g&&a.width(g),e.click(function(){e.hasClass("selectedLegend")||(jQuery(".scroll-content-item").removeClass("selectedLegend"),e.addClass("selectedLegend"),b.css("background-image",e.css("background-image")))})}function z(){var a=jQuery(".scroll-pane"),b=jQuery(".scroll-content");b.width()<a.outerWidth(!0)&&b.width(a.outerWidth(!0));var c=jQuery(".scroll-bar").slider({slide:function(c,d){b.width()>a.width()?b.css("margin-left",Math.round(d.value/100*(a.width()-b.width()))+"px"):b.css("margin-left",0)}}),d=c.find(".ui-slider-handle").mousedown(function(){c.width(d.width())}).mouseup(function(){c.width("100%")}).append("<span class='ui-icon ui-icon-grip-dotted-vertical'></span>").wrap("<div class='ui-handle-helper-parent'></div>").parent();a.css("overflow","hidden");var e=function(){var d=a.width()-b.width();d>0&&(d=0);var e="auto"===b.css("margin-left")?0:parseInt(b.css("margin-left"),10),f=d?Math.round(e/d*100):0;c.slider("value",f)},f=function(){if(b.width()>a.width()){var c=b.width()+parseInt(b.css("margin-left"),10),d=a.width()-c;d>0&&b.css("margin-left",parseInt(b.css("margin-left"),10)+d+"px")}else b.css("margin-left",0)},g=function(){var e=b.width()-a.width();0>e&&(e=0);var f=e/b.width(),g=a.width()-f*a.width();c.find(".ui-slider-handle").css({width:Math.floor(g),"margin-left":-Math.floor(g/2)}),d.width(Math.floor(c.width()-g))};Z=function(){jQuery("#"+S.legendDivId).hasClass("animatorLegendNoLegend")||(e(),f(),g())
};var h=setTimeout(function(){g(),gb.splice(gb.indexOf(h),1),h=void 0},10);gb.push(h)}function A(){z()}function B(){if(S.legendDivId){var a,b,c,d,e,f,g=T.getLayers(),h=jQuery("#"+S.legendDivId);h.empty();var i=0;for(a=0;a<g.length;++a)if(c=g[a],c.getVisibility()&&c.getLegendInfo)for(d=c.getLegendInfo(),b=0;b<d.length;++b)e=d[b],e.hasLegend&&++i;if(i)if(1===i){for(h.removeClass("animatorLegendNoLegend"),S.animationDivId&&jQuery("#"+S.animationDivId).removeClass("animatorAnimationNoLegend"),f=jQuery('<div class="animatorLegendView animatorLegendViewOne"></div>'),h.append(f),a=0;a<g.length;++a)if(c=g[a],c.getVisibility()&&c.getLegendInfo)for(d=c.getLegendInfo(),b=0;b<d.length;++b)if(e=d[b],e.hasLegend){f.css("background-image","url('"+e.url+"')");break}}else{h.removeClass("animatorLegendNoLegend"),S.animationDivId&&jQuery("#"+S.animationDivId).removeClass("animatorAnimationNoLegend");var j=jQuery('<div class="animatorLegendThumbnails"></div>');j.append('<div class="scroll-pane ui-widget ui-widget-header ui-corner-all"><div class="scroll-content"></div><div class="scroll-bar-wrap ui-widget-content ui-corner-bottom"><div class="scroll-bar"></div></div></div>'),h.append(j),f=jQuery('<div class="animatorLegendView"></div>'),h.append(f);var k=jQuery(".scroll-content"),l=!1;for(a=0;a<g.length;++a)if(c=g[a],c.getVisibility()&&c.getLegendInfo)for(d=c.getLegendInfo(),b=0;b<d.length;++b)e=d[b],e.hasLegend&&(y(k,f,e,!l),l=!0);A()}else h.addClass("animatorLegendNoLegend"),S.animationDivId&&jQuery("#"+S.animationDivId).addClass("animatorAnimationNoLegend")}else S.animationDivId&&jQuery("#"+S.animationDivId).addClass("animatorAnimationNoLegend");ab&&ab()}function C(a){if(a&&S.legendDivId)for(var b=function(a){a&&a.object&&a.object.getLegendInfo&&!a.object.getLegendInfo().length&&a.object.getVisibility&&a.object.getVisibility()&&!_.contains(eb,a.object)?eb.push(a.object):B()},c={visibilitychanged:b,added:B,removed:B},d=0;d<a.length;++d){var e=a[d];e.events&&e.getLegendInfo&&e.events.on(c)}}function D(a,b,c){if(a){var d;b&&(d={div:OpenLayers.Util.getElement(b)});var e=new OpenLayers.Control.LayerSwitcher(d);a.addControl(e),c||e.minimizeControl()}}function E(){$&&($.remove(),$=void 0,ab=void 0)}function F(a,b,c){var d=new fi.fmi.metoclient.ui.animator.Controller(a[0],a.width(),a.height(),e());return d.setTimeModel(b),d.setTimeController(c),d}function G(){if(!(S&&S.controllerDivId&&S.playAndPauseDivId))throw"ERROR: Options or properties missing for controller!";if(void 0!==h()&&void 0!==i()){var a="#"+S.controllerDivId,b=jQuery(a);if(b.length){var c=m(),d=((new Date).getTime(),h().getTime()),e=i().getTime(),f=k().getTime();f>e&&(f=void 0);var g=[],l=[],o=[],p=[],q={getStartTime:function(){return d},getEndTime:function(){return e},getResolution:function(){return j()},getForecastStartTime:function(){return f},getAnimationShowUtc:function(){return c},addTimePeriodChangeListener:function(a){g.push(a)},addTimeSelectionChangeListener:function(a){l.push(a)},addAnimationEventsListener:function(a){db.push(a)},addForecastStartTimeChangeListener:function(a){o.push(a)},addTickIntervalChangeListener:function(a){p.push(a)}},r={proposeTimePeriodChange:function(){},proposeTimeSelectionChange:function(a){var b=j();if(b&&void 0!==a&&null!==a){if(d>a)a=d;else if(a>e)a=e;else{var c=a%b;c&&(a=a-c+b)}s(a,l)}},proposeNextFrame:function(){w()},proposePreviousFrame:function(){x()},proposePause:function(){u()}};n(),$=F(b,q,r);var t=b.width();ab=function(){var c=jQuery(a).width();c!==t&&(t=c,$.remove(),$=F(b,q,r))}}}}function H(a,b){for(var c=0;c<b.length;++c){var e=b[c];if(Y&&Y.length===b.length){var f=Y[c];f!==e.getVisibility()&&e.setVisibility(f)}e.registerController&&e.registerController(d.events),e.events&&e.events.on(hb),a.addLayer(e)}}function I(){var a=T.getMap(),b=a.getZoom(),c=a.getMinZoom(),d=c+a.getNumZoomLevels()-1;jQuery(".olControlZoomOut").removeClass("animatorControlZoomDisable"),jQuery(".olControlZoomIn").removeClass("animatorControlZoomDisable"),c>=b&&jQuery(".olControlZoomOut").addClass("animatorControlZoomDisable"),b>=d&&jQuery(".olControlZoomIn").addClass("animatorControlZoomDisable")}function J(){if(S.mapDivId){var a=T.getMap();if(a){a.events.on({zoomend:I}),a.render(S.mapDivId);var b=T.getLayers();b&&(H(a,b),setTimeout(function(){B(),G(),C(b),D(a,S.layerSwitcherDivId,S.maximizeSwitcher)},0));var c=X||a.getCenter();c||(c=a.getMaxExtent().getCenterLonLat()),a.setCenter(c,void 0===W?T.getDefaultZoomLevel():W)}}}function K(a,b){if(b&&b.length)"undefined"!=typeof console&&console&&console.error("ERROR: Animator config init errors. Animation is not created!"),Y=void 0,ib(a.callback,b);else try{J()}catch(c){var d="ERROR: ConfigInitCallback: "+c.toString();b.push(d),"undefined"!=typeof console&&console&&console.error(d)}finally{Y=void 0,ib(a.callback,b)}}function L(){S&&(S.animatorContainerDivId?jQuery("#"+S.animatorContainerDivId+" > .animator").remove():(S.animationDivId&&jQuery("#"+S.animationDivId).remove(),S.mapDivId&&jQuery("#"+S.mapDivId).remove(),S.layerSwitcherDivId&&jQuery("#"+S.layerSwitcherDivId).remove(),S.controllerDivId&&jQuery("#"+S.controllerDivId).remove(),S.playAndPauseDivId&&jQuery("#"+S.playAndPauseDivId).remove(),S.logoDivId&&jQuery("#"+S.logoDivId).remove(),S.legendDivId&&jQuery("#"+S.legendDivId).remove()))}function M(a){if(!fi.fmi.metoclient.ui.animator.Utils.isBrowserSupported()){var b=T.getBrowserNotSupportedInfo();if(a){var c=a.animatorContainerDivId||a.animationDivId;c&&jQuery("#"+c).append('<div class="errorInfo">'+b+"</div>")}throw b}if(a){if(a.animatorContainerDivId){var d=jQuery('<div class="animator"><div class="animatorAnimation" id="animatorAnimationId"><div class="animatorMap" id="animatorMapId"></div><div class="animatorLogo" id="animatorLogoId"></div><div class="animatorController" id="animatorControllerId"></div><div class="animatorPlayAndPause" id="animatorPlayAndPauseId"></div><div class="animatorLayerSwitcher" id="animatorLayerSwitcherId"></div></div><div class="animatorLegend" id="animatorLegendId"></div></div>');jQuery("#"+a.animatorContainerDivId).append(d),a.animationDivId="animatorAnimationId",a.mapDivId="animatorMapId",a.layerSwitcherDivId="animatorLayerSwitcherId",a.controllerDivId="animatorControllerId",a.playAndPauseDivId="animatorPlayAndPauseId",a.logoDivId="animatorLogoId",a.legendDivId="animatorLegendId"}if(a.animationDivId&&(T.showAnimationInitProgress()||T.showAnimationLoadProgress())){var e=jQuery('<div class="animatorLoadProgressbar"></div>');jQuery("#"+a.animationDivId).append(e),e.progressbar({value:!1}),e.hide()}}}function N(){var a=T.getAnimationRefreshInterval();if(a&&a>0){var b=setTimeout(function(){var a=S,b=V,c=void 0!==U,d=T.getMap().getCenter(),e=T.getMap().getZoom(),f=[];_.each(T.getLayers(),function(a){f.push(a.getVisibility())}),Q(),cb=c,X=d,W=e,Y=f,V=b,R(a)},a);gb.push(b)}}function O(){if(S&&!S.callback){var a="ERROR: Animator init options.callback is mandatory if getConfig is used!";throw"undefined"!=typeof console&&console&&console.error(a),a}return T}function P(){if(jQuery(window).resize(),T){var a=T.getMap();a&&a.updateSize()}}function Q(){if(T){var a=T.getMap();a&&a.destroy()}for(;gb.length;)clearTimeout(gb.pop());db=[],fb=[],cb=!1,X=void 0,W=void 0,Y=void 0,U=void 0,V=void 0,Z=void 0,eb=[],L(),E(),T=void 0,S=void 0}function R(b){if(!S&&b)try{S=b,T=new fi.fmi.metoclient.ui.animator.Factory(_.cloneDeep(b.config||fi.fmi.metoclient.ui.animator.Config,a)),M(b),N(),T.showAnimationInitProgress()&&jQuery(".animatorLoadProgressbar").show(),T.init(function(a,c){jQuery(".animatorLoadProgressbar").hide(),K(b,c)})}catch(c){var d=c.toString();"undefined"!=typeof console&&console&&console.error("ERROR: Animator init error: "+d),jQuery(".animatorLoadProgressbar").hide(),ib(b.callback,[d])}}var S,T,U,V,W,X,Y,Z,$,ab,bb=this,cb=!1,db=[],eb=[],fb=[],gb=[],hb={scope:bb,animationloadstarted:void 0,frameloadstarted:void 0,frameloadcomplete:void 0,animationloadgroupprogress:void 0,animationloadcomplete:void 0,animationframecontentreleased:void 0,framechanged:void 0};hb.animationloadstarted=function(a){if(a&&a.object){var b=eb.indexOf(a.object);-1!==b&&(eb.splice(b,1),a&&a.object&&a.object.getLegendInfo&&a.object.getLegendInfo().length&&a.object.getVisibility&&a.object.getVisibility()&&B())}void 0!==U&&(cb=!0),f(a.layer),u(),jQuery.each(db,function(b,c){c.loadAnimationStartedCb(a)})},hb.frameloadstarted=function(a){jQuery.each(db,function(b,c){c.loadFrameStartedCb(a)})},hb.frameloadcomplete=function(a){jQuery.each(db,function(b,c){c.loadFrameCompleteCb(a)})},hb.animationloadgroupprogress=function(a){jQuery.each(db,function(b,c){c.loadGroupProgressCb(a)})},hb.animationloadcomplete=function(a){g(a.layer),T.getAnimationAutoStart()||cb?(cb=!1,t()):p(),jQuery.each(db,function(b,c){c.loadCompleteCb(a)})},hb.animationframecontentreleased=function(a){void 0!==U&&(cb=!0,u()),g(a.layer),jQuery.each(db,function(b,c){c.animationFrameContentReleasedCb(a)})},hb.framechanged=function(a){jQuery.each(db,function(b,c){c.frameChangedCb(a)})},jQuery(window).resize(_.debounce(function(){Z&&Z(),ab&&ab()},b,{maxWait:c}));var ib=function(a,b){a&&setTimeout(function(){try{a(bb,b)}catch(c){"undefined"!=typeof console&&console&&console.error("ERROR: Callback function error: "+c.toString())}},0)};this.init=R,this.reset=Q,this.refresh=P,this.getConfig=O};return e}();